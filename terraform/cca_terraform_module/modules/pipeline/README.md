# The `pipeline` Module

The `pipeline` reusable module is used deploy the pipeline AWS resources for this solution.  

## Variables

### Variables from the `common_variables` Module

The below table lists variables that are meant to only take references from the `common_variables` module:

| Name                                                                                                                         | Description                                                                                                                                                                | Type           | Default                                     | Possible Values                                                                                               | Required |
|------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------|---------------------------------------------|---------------------------------------------------------------------------------------------------------------|----------|
| <a name="input_bucket_arn"></a> bucket\_arn                                                                                  | The ARN of the S3 Bucket to which the Kubecost data will be uploaded. Meant to only take a reference to the "bucket_arn" output from the common module                     | `string`       | n/a                                         | Only `module.common_variables.bucket_arn`                                                                     | yes      |
| <a name="input_k8s_labels"></a> k8s\_labels                                                                                  | K8s labels common across all clusters, that you wish to include in the dataset. Meant to only take a reference to the "k8s_labels" output from the common module           | `list(string)` | `[]`                                        | Only `module.common_variables.k8s_labels`                                                                     | no       |
| <a name="input_k8s_annotations"></a> k8s\_annotations                                                                        | K8s annotations common across all clusters, that you wish to include in the dataset. Meant to only take a reference to the "k8s_annotations" output from the common module | `list(string)` | `[]`                                        | Only `module.common_variables.k8s_annotations`                                                                | no       |
| <a name="input_aws_common_tags"></a> aws\_common\_tags                                                                       | Common AWS tags to be used on all AWS resources created by Terraform. Meant to only take a reference to the "aws_common_tags" output from the common module                | `map(any)`     | `{}`                                        | Only `module.common_variables.aws_common_tags`                                                                | no       |

### This Module's Variables

The below table lists the `pipeline` module's variables:

| Name                                                                                         | Description                                                                                                              | Type                                                                                                                                                        | Default          | Possible Values                                     | Required |
|----------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------|-----------------------------------------------------|----------|
| <a name="input_glue_database_name"></a> glue\_database\_name                                 | The AWS Glue database name                                                                                               | `string`                                                                                                                                                    | kubecost_db      | A valid AWS Glue database name                      | no       |
| <a name="input_glue_table_name"></a> glue\_table\_name                                       | The AWS Glue table name                                                                                                  | `string`                                                                                                                                                    | kubecost_table   | A valid AWS Glue table name                         | no       |
| <a name="input_glue_view_name"></a> glue\_view\_name                                         | The AWS Glue table name for the Athena view                                                                              | `string`                                                                                                                                                    | kubecost_view    | A valid AWS Glue table name                         | no       |
| <a name="input_glue_crawler_name"></a> glue\_crawler\_name                                   | The AWS Glue crawler name                                                                                                | `string`                                                                                                                                                    | kubecost crawler | A valid AWS Glue crawler name                       | no       |
| <a name="input_glue_crawler_schedule"></a> glue\_crawler\_schedule                           | The schedule for the Glue Crawler, in Cron format. Make sure to set it after the last Kubecost S3 Exporter Cron schedule | `string`                                                                                                                                                    | 0 1 * * ? *      | A valid Cron expression. For example, `0 1 * * ? *` | no       |
| <a name="input_athena_view_data_retention_months"></a> athena\_view\_data\_retention\_months | The amount of months back to keep data in the Athena view                                                                | `string`                                                                                                                                                    | 6                | A non-zero positive integer                         | no       |
| <a name="input_kubecost_ca_certificates_list"></a> kubecost\_ca\_certificates\_list          | A list of objects containing CA certificates paths and their desired secret name in AWS Secrets Manager                  | <pre>list(object({<br>    cert_path = string<br>    cert_secret_name = string<br>    cert_secret_allowed_principals = optional(list(string))<br>  }))</pre> | `[]`             |                                                     | no       |

The below table lists the inputs of the `kubecost_ca_certificates_list` variable:

| Name                                                                                  | Description                                                                         | Type           | Default | Possible Values                         | Required |
|---------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|----------------|---------|-----------------------------------------|----------|
| <a name="input_cert_path"></a> cert\_path                                             | Local path (including file name) to the CA certificate file                         | `string`       | n/a     | A path                                  | yes      |
| <a name="input_cert_secret_name"></a> cert\_secret\_name                              | The AWS Secrets Manager secret name to be used for the CA certificate               | `string`       | n/a     | A valid AWS Secrets Manager secret name | yes      |
| <a name="input_cert_secret_allowed_principals"></a> cert\_secret\_allowed\_principals | A list of additional principal ARNs to add to the AWS Secrets Manager secret policy | `list(string)` | n/a     | A list of principal ARNs                | no       |