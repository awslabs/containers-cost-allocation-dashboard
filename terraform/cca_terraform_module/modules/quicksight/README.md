# The `quicksight` Module

The `quicksight` reusable module is used deploy the QuickSight resources for this solution.  

## Variables

### Variables from the `common_variables` Module

The below table lists variables that are meant to only take references from the `common_variables` module:

| Name                                                                                                                         | Description                                                                                                                                                                | Type           | Default                                     | Possible Values                                                                                               | Required |
|------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------|---------------------------------------------|---------------------------------------------------------------------------------------------------------------|----------|
| <a name="input_bucket_arn"></a> bucket\_arn                                                                                  | The ARN of the S3 Bucket to which the Kubecost data will be uploaded. Meant to only take a reference to the "bucket_arn" output from the common module                     | `string`       | n/a                                         | Only `module.common_variables.bucket_arn`                                                                     | yes      |
| <a name="input_k8s_labels"></a> k8s\_labels                                                                                  | K8s labels common across all clusters, that you wish to include in the dataset. Meant to only take a reference to the "k8s_labels" output from the common module           | `list(string)` | `[]`                                        | Only `module.common_variables.k8s_labels`                                                                     | no       |
| <a name="input_k8s_annotations"></a> k8s\_annotations                                                                        | K8s annotations common across all clusters, that you wish to include in the dataset. Meant to only take a reference to the "k8s_annotations" output from the common module | `list(string)` | `[]`                                        | Only `module.common_variables.k8s_annotations`                                                                | no       |
| <a name="input_aws_common_tags"></a> aws\_common\_tags                                                                       | Common AWS tags to be used on all AWS resources created by Terraform. Meant to only take a reference to the "aws_common_tags" output from the common module                | `map(any)`     | `{}`                                        | Only `module.common_variables.aws_common_tags`                                                                | no       |

### Variables from the `pipeline` Module

The below table lists variables that are meant to only take references from the `pipeline` module:

| Name                                                                                 | Description                                                                                                                                                                                           | Type                                                                                                                                                                                                                                                                                                                  | Default                                                                                                       | Possible Values                                   | Required |
|--------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------|---------------------------------------------------|----------|
| <a name="input_glue_database_name"></a> glue\_database\_name                         | The AWS Glue database name. Meant to only take a reference to the "glue_database_name" output from the pipeline module                                                                                | `string`                                                                                                                                                                                                                                                                                                              | n/a                                                                                                           | Must be only `module.pipeline.glue_database_name` | yes      |
| <a name="input_glue_view_name"></a> glue\_view\_name                                 | The AWS Glue view name. Meant to only take a reference to the "glue_view_name" output from the pipeline module                                                                                        | `string`                                                                                                                                                                                                                                                                                                              | n/a                                                                                                           | Must be only `module.pipeline.glue_view_name`     | yes      |

### This Module's Variables

The below table list variables that are specific to the `quicksight` module:


The below table lists the `quicksight` module's variables:

| Name                                                                                 | Description                                                                                                                                                                                           | Type                                                                                                                                                                                                                                                                                                                  | Default                                                                                                       | Possible Values                                   | Required |
|--------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------|---------------------------------------------------|----------|
| <a name="input_glue_database_name"></a> glue\_database\_name                         | The AWS Glue database name. Meant to only take a reference to the "glue_database_name" output from the pipeline module                                                                                | `string`                                                                                                                                                                                                                                                                                                              | n/a                                                                                                           | Must be only `module.pipeline.glue_database_name` | yes      |
| <a name="input_glue_view_name"></a> glue\_view\_name                                 | The AWS Glue view name. Meant to only take a reference to the "glue_view_name" output from the pipeline module                                                                                        | `string`                                                                                                                                                                                                                                                                                                              | n/a                                                                                                           | Must be only `module.pipeline.glue_view_name`     | yes      |
| <a name="input_athena_workgroup_configuration"></a> athena\_workgroup\_configuration | An object representing the configuration the Athena Workgroup. Used either to create a new Athena Workgroup, or reference an existing Athena Workgroup                                                | <pre>object({<br>    create                             = optional(bool, true)<br>    name                               = optional(string, "kubecost")<br>    query_results_location_bucket_name = optional(string, "")<br>  })</pre>                                                                                | <pre>{<br>  "create": true,<br>  "name": "kubecost",<br>  "query_results_location_bucket_name": ""<br>}</pre> |                                                   | no       |
| <a name="input_qs_common_users"></a> qs\_common\_users                               | A list of QuickSight users and and their permissions for each QuickSight asset created by this module. Add users here if you want them to have access to all QuickSight assets created by this module | <pre>list(object({<br>    username                = string<br>    data_source_permissions = optional(string, "Owner")<br>    data_set_permissions    = optional(string, "Owner")<br>    analysis_permissions    = optional(string, "Owner")<br>    dashboard_permissions   = optional(string, "Owner")<br>  }))</pre> | `[]`                                                                                                          |                                                   | no       |
| <a name="input_qs_data_source_settings"></a> qs\_data\_source\_settings              | An object representing the configuration the QuickSight data source.                                                                                                                                  | <pre>object({<br>    name = optional(string, "cca_kubecost")<br>    users = optional(list(object({<br>      username    = string<br>      permissions = optional(string, "Owner")<br>    })), [])<br>  })</pre>                                                                                                       | <pre>{<br>  "name": "cca_kubecost",<br>  "users": []<br>}</pre>                                               |                                                   | no       |
| <a name="input_qs_data_set_settings"></a> qs\_data\_set\_settings                    | An object representing the configuration the QuickSight dataset.                                                                                                                                      | <pre>object({<br>    dataset_refresh_schedule = optional(string, "05:00")<br>    timezone                 = optional(string, "")<br>    users = optional(list(object({<br>      username    = string<br>      permissions = optional(string, "Owner")<br>    })), [])<br>  })</pre>                                   | <pre>{<br>  "dataset_refresh_schedule": "05:00",<br>  "timezone": "",<br>  "users": []<br>}</pre>             |                                                   | no       |

The below table lists the inputs of the `athena_workgroup_configuration` variable:

| Name                                                                                          | Description                                                                                                                                                                                                                | Type     | Default  | Possible Values               | Required      |
|-----------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|----------|-------------------------------|---------------|
| <a name="input_create"></a> create                                                            | Dictates whether to create a custom Athena Workgroup                                                                                                                                                                       | `bool`   | `true`   | `true` or `false`             | no            |
| <a name="input_name"></a> name                                                                | If `create` is `true`, used to define the created Athena Workgroup name, and to reference it in the QuickSight Data Source. If `create` is `false`, used only for referencing the Workgroup in the QuickSight Data Source. | `string` | kubecost | A valid Athena Workgroup name | no            |
| <a name="input_query_results_location_bucket_name"></a> query\_result\_location\_bucket\_name | Required only when `create` is `true`. In this case, used to set the Athena Workgroup query results location. If `create` is `false`, this field is ignored.                                                               | `string` | ""       | A valid S3 bucket name        | conditionally |

The below table lists the inputs of the `qs_common_users` variable (for each object in the list):

| Name                                                                   | Description                                                  | Type     | Default | Possible Values             | Required      |
|------------------------------------------------------------------------|--------------------------------------------------------------|----------|---------|-----------------------------|---------------|
| <a name="input_username"></a> username                                 | The QuickSight username                                      | `string` | n/a     | A valid QuickSight username | yes           |
| <a name="input_data_source_permissions"></a> data\_source\_permissions | The user's permissions for the QuickSight data source asset. | `string` | Owner   | "Owner" or "Viewer"         | no            |
| <a name="input_data_set_permissions"></a> data\_set\_permissions       | The user's permissions for the QuickSight dataset asset.     | `string` | Owner   | "Owner" or "Viewer"         | no            |

The below table lists the inputs of the `qs_data_source_settings` variable (for each object in the list):

| Name                             | Description                                                  | Type                                                                                                                    | Default        | Possible Values                     | Required |
|----------------------------------|--------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------|----------------|-------------------------------------|----------|
| <a name="input_name"></a> name   | The name of the QuickSight data source                       | `string`                                                                                                                | "cca_kubecost" | A valid QuickSight data source name | no       |
| <a name="input_users"></a> users | The user's permissions for the QuickSight data source asset. | <pre>list(object({<br>      username    = string<br>      permissions = optional(string, "Owner")<br>    })), [])</pre> | `[]`           |                                     | no       |

The below table lists the inputs of the `users` list in the `qs_data_source_settings` variable:

| Name                                         | Description                                                 | Type     | Default | Possible Values             | Required |
|----------------------------------------------|-------------------------------------------------------------|----------|---------|-----------------------------|----------|
| <a name="input_username"></a> username       | The QuickSight username                                     | `string` | n/a     | A valid QuickSight username | yes      |
| <a name="input_permissions"></a> permissions | The user's permissions for the QuickSight data source asset | `string` | Owner   | "Owner" or "Viewer"         | no       |

The below table lists the inputs of the `qs_data_set_settings` variable (for each object in the list):

| Name                                                                     | Description                                             | Type                                                                                                                    | Default                                                                               | Possible Values                                         | Required |
|--------------------------------------------------------------------------|---------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------|---------------------------------------------------------|----------|
| <a name="input_name"></a> name                                           | The name of the QuickSight dataset                      | `string`                                                                                                                | "cca_kubecost"                                                                        | A valid QuickSight dataset name                         | no       |
| <a name="input_dataset_refresh_schedule"></a> dataset\_refresh\_schedule | The hour of the day for the dataset refresh schedule    | `string`                                                                                                                | "05:00"                                                                               | An hour of the day, in the format of "HH:MM"            | no       |
| <a name="input_timezone"></a> timezone                                   | The timezone for the dataset refresh schedule           | `string`                                                                                                                | "" (a timezone will be automatically chosen based on the QuickSight account's region) | One of the timezones listed in the "timezones.txt" file | no       |
| <a name="input_users"></a> users                                         | The user's permissions for the QuickSight dataset asset | <pre>list(object({<br>      username    = string<br>      permissions = optional(string, "Owner")<br>    })), [])</pre> | `[]`                                                                                  |                                                         | no       |

The below table lists the inputs of the `users` list in the `qs_data_set_settings` variable:

| Name                                         | Description                                             | Type     | Default | Possible Values             | Required |
|----------------------------------------------|---------------------------------------------------------|----------|---------|-----------------------------|----------|
| <a name="input_username"></a> username       | The QuickSight username                                 | `string` | n/a     | A valid QuickSight username | yes      |
| <a name="input_permissions"></a> permissions | The user's permissions for the QuickSight dataset asset | `string` | Owner   | "Owner" or "Viewer"         | no       |