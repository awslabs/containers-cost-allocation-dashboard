# The `kubecost_s3_exporter` Module

The `kubecost_s3_exporter` reusable module is used deploy the Kubecost S3 Exporter, including:

* The K8s resources (CronJob and Service Account)
* IAM roles

## Variables

### Variables from the `common_variables` Module

The below table lists variables that are meant to only take references from the `common_variables` module:

| Name                                                                                                                         | Description                                                                                                                                                                | Type           | Default                                     | Possible Values                                                                                               | Required |
|------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------|---------------------------------------------|---------------------------------------------------------------------------------------------------------------|----------|
| <a name="input_bucket_arn"></a> bucket\_arn                                                                                  | The ARN of the S3 Bucket to which the Kubecost data will be uploaded. Meant to only take a reference to the "bucket_arn" output from the common module                     | `string`       | n/a                                         | Only `module.common_variables.bucket_arn`                                                                     | yes      |
| <a name="input_k8s_labels"></a> k8s\_labels                                                                                  | K8s labels common across all clusters, that you wish to include in the dataset. Meant to only take a reference to the "k8s_labels" output from the common module           | `list(string)` | `[]`                                        | Only `module.common_variables.k8s_labels`                                                                     | no       |
| <a name="input_k8s_annotations"></a> k8s\_annotations                                                                        | K8s annotations common across all clusters, that you wish to include in the dataset. Meant to only take a reference to the "k8s_annotations" output from the common module | `list(string)` | `[]`                                        | Only `module.common_variables.k8s_annotations`                                                                | no       |
| <a name="input_aws_common_tags"></a> aws\_common\_tags                                                                       | Common AWS tags to be used on all AWS resources created by Terraform. Meant to only take a reference to the "aws_common_tags" output from the common module                | `map(any)`     | `{}`                                        | Only `module.common_variables.aws_common_tags`                                                                | no       |

### Variables from the `pipeline` Module

The below table lists variables that are meant to only take references from the `pipeline` module:

| Name                                                                                                                         | Description                                                                                                                                                                | Type           | Default                                     | Possible Values                                                                                               | Required |
|------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------|---------------------------------------------|---------------------------------------------------------------------------------------------------------------|----------|
| <a name="input_kubecost_ca_certificate_secrets"></a> kubecost\_ca\_certificate\_secrets                                      | A list of AWS Secret Manager secrets created by the pipeline module. Meant to only take a reference to the "kubecost_ca_cert_secret" output from the pipeline module.      | `list(any)`    | `[]`                                        | Only `module.pipeline.kubecost_ca_cert_secret`                                                                | no       |

### This Module's Variables

The below table list variables that are specific to the `kubecost_s3_exporter` module:

| Name                                                                                                                         | Description                                                                                                                                                                | Type           | Default                                     | Possible Values                                                                                               | Required |
|------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------|---------------------------------------------|---------------------------------------------------------------------------------------------------------------|----------|
| <a name="input_cluster_arn"></a> cluster\_arn                                                                                | The EKS cluster ARN in which the Kubecost S3 Exporter pod will be deployed                                                                                                 | `string`       | n/a                                         | An EKS Cluster ARN                                                                                            | yes      |
| <a name="input_kubecost_s3_exporter_container_image"></a> kubecost\_s3\_exporter\_container\_image                           | The Kubecost S3 Exporter container image                                                                                                                                   | `string`       | n/a                                         | A Docker container image (`<registry_url>/<repo>:<tag>`)                                                      | yes      |
| <a name="input_kubecost_s3_exporter_container_image_pull_policy"></a> kubecost\_s3\_exporter\_container\_image\_pull\_policy | The image pull policy that'll be used by the Kubecost S3 Exporter pod                                                                                                      | `string`       | Always                                      | One of "Always", "IfNotPresent" or "Never"                                                                    | no       |
| <a name="input_kubecost_s3_exporter_cronjob_schedule"></a> kubecost\_s3\_exporter\_cronjob\_schedule                         | The schedule of the Kubecost S3 Exporter CronJob                                                                                                                           | `string`       | 0 0 * * *"                                  | A Cron expression. For example, `0 0 * * *`                                                                   | no       |
| <a name="input_kubecost_s3_exporter_ephemeral_volume_size"></a> kubecost\_s3\_exporter\_ephemeral\_volume\_size              | The ephemeral volume size for the Kubecost S3 Exporter pod                                                                                                                 | `string`       | "50Mi"                                      | A volume size in the format of 'NMi', where N >= 1. For example, 10Mi, 50Mi, 100Mi, 150Mi                     | no       |
| <a name="input_kubecost_api_endpoint"></a> kubecost\_api\_endpoint                                                           | The Kubecost API endpoint in format of 'http://<name\_or\_ip>:<port>'                                                                                                      | `string`       | http://kubecost-cost-analyzer.kubecost:9090 | A URI in the format of http://<name_or_ip>:[port]' or 'https://<name_or_ip>:[port]                            | no       |
| <a name="input_backfill_period_days"></a> backfill\_period\_days                                                             | The number of days to check for backfilling                                                                                                                                | `number`       | 15                                          | A positive integer equal or larger than 3                                                                     | no       |
| <a name="input_aggregation"></a> aggregation                                                                                 | The aggregation to use for returning the Kubecost Allocation API results                                                                                                   | `string`       | container                                   | One of "container", "pod", "namespace", "controller", "controllerKind", "node", or "cluster" (case-sensitive) | no       |
| <a name="input_kubecost_allocation_api_paginate"></a> kubecost_allocation_api_paginate                                       | Dictates whether to paginate using 1-hour time ranges (relevant for 1h step)                                                                                               | `string`       | False                                       | One of "Yes", "No", "Y", "N", "True" or "False" (case-insensitive)                                            | no       |
| <a name="input_connection_timeout"></a> connection_timeout                                                                   | The time (in seconds) to wait for TCP connection establishment                                                                                                             | `number`       | 10                                          | A float larger than 0 (for example, 0.1, 1, 3.5, 5, 10)                                                       | no       |
| <a name="input_kubecost_allocation_api_read_timeout"></a> kubecost_allocation_api_read_timeout                               | The time (in seconds) to wait for the Kubecost Allocation On-Demand API to send an HTTP response                                                                           | `number`       | 60                                          | A float larger than 0 (for example, 0.1, 1, 3.5, 5, 10)                                                       | no       |
| <a name="input_tls_verify"></a> tls_verify                                                                                   | Dictates whether TLS certificate verification is done for HTTPS connections                                                                                                | `string`       | True                                        | One of "Yes", "No", "Y", "N", "True" or "False" (case-insensitive)                                            | no       |
| <a name="input_kubecost_ca_certificate_secret_name"></a> kubecost\_ca\_certificate\_secret\_name                             | The AWS Secrets Manager secret name, for the CA certificate used for verifying Kubecost's server certificate when using HTTPS                                              | `string`       | ""                                          | A valid AWS Secrets Manager secret name                                                                       | no       |
| <a name="input_namespace"></a> namespace                                                                                     | The namespace in which the Kubecost S3 Exporter pod and service account will be created                                                                                    | `string`       | kubecost-s3-exporter                        | A valid namespace name                                                                                        | no       |
| <a name="input_create_namespace"></a> create\_namespace                                                                      | Dictates whether to create the namespace as part of the Helm Chart deployment                                                                                              | `bool`         | true                                        | `true` or `false`                                                                                             | no       |
| <a name="input_service_account"></a> service\_account                                                                        | The service account for the Kubecost S3 Exporter pod                                                                                                                       | `string`       | kubecost-s3-exporter                        | A valid service account name                                                                                  | no       |
| <a name="input_create_service_account"></a> create\_service\_account                                                         | Dictates whether to create the service account as part of the Helm Chart deployment                                                                                        | `bool`         | true                                        | `true` or `false`                                                                                             | no       |
| <a name="input_invoke_helm"></a> invoke\_helm                                                                                | Dictates whether to invoke Helm to deploy the K8s resources (the kubecost-s3-exporter CronJob and the Service Account)                                                     | `bool`         | true                                        | `true` or `false`                                                                                             | no       |
